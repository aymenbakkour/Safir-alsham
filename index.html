<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø³ÙÙŠØ± Ø§Ù„Ø´Ø§Ù…</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <style>
    body { background: #f4f4f4; font-family: "Tahoma", sans-serif; }
    .section-box { background: white; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1.25rem; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1),0 2px 4px -1px rgba(0,0,0,0.06); }

    .form-control { width: 100%; padding: 0.5rem; margin-top: 0.5rem; border-radius: 0.375rem; border:1px solid #d1d5db; box-sizing:border-box; font-size:16px; background-color:#fff; outline:none; transition:border-color 0.15s ease-in-out,box-shadow 0.15s ease-in-out;}
    .form-control:focus { border-color:transparent; box-shadow:0 0 0 2px rgba(59,130,246,0.5); }
    .btn { width:100%; padding:0.75rem 1rem; border:none; border-radius:0.375rem; font-weight:600; color:white; cursor:pointer; transition:background-color 0.15s ease-in-out,box-shadow 0.15s ease-in-out; outline:none;}
    .btn-primary { background-color:#2563eb; } .btn-primary:hover { background-color:#1d4ed8; }
    .btn-success { background-color:#10b981; } .btn-success:hover { background-color:#059669; }
    .btn-danger { background-color:#ef4444; } .btn-danger:hover { background-color:#dc2626; }
    .btn-indigo { background-color:#4f46e5; } .btn-indigo:hover { background-color:#4338ca; }
    .btn-sm { padding:0.25rem 0.5rem; font-size:0.875rem; }
    .btn:disabled { opacity:0.6; cursor:not-allowed; }

    .container-wrapper { max-width:64rem; margin:auto; padding-top:0.75rem; padding-bottom:0.75rem; }
    .mb-4 { margin-bottom:1rem; } .mt-4 { margin-top:1rem; }

    /* Products */
    .category-header { background:#e9ecef; padding:0.5rem; border-radius:0.375rem; cursor:pointer; font-weight:700; display:flex; justify-content:space-between; align-items:center; }
    .product-row { display:flex; justify-content:space-between; align-items:center; padding:0.5rem; border-bottom:1px solid #e5e7eb; }
    .product-row:last-child { border-bottom:none; }
    .product-name { flex:1; font-weight:500; }
    .product-price { margin-left:1rem; color:#4b5563; }

    /* Ø²Ø± Ø¥Ø¶Ø§ÙØ© Ø¯Ø§Ø¦Ø±ÙŠ */
    .add-btn-circle {
      width:2rem; height:2rem; border-radius:50%; background:#0d6efd; color:white; border:none; font-size:1.25rem; display:flex; align-items:center; justify-content:center; cursor:pointer;
    }
    .add-btn-circle:hover { background:#0b5ed7; }

    /* Offer items */
    .offer-item { display:flex; justify-content:space-between; padding:0.5rem; border-bottom:1px solid #e5e7eb; }
    .offer-item:last-child { border-bottom:none; }
    .offer-item button { width:1.5rem; height:1.5rem; padding:0; font-size:0.875rem; }

    /* Preview */
    #preview { border:2px solid #2563eb; padding:1rem; border-radius:1rem; background:white; text-align:center; min-height:150px; display:flex; flex-direction:column; justify-content:center; align-items:center; }
    .preview-title { font-size:1.5rem; font-weight:bold; color:#0d6efd; }
  </style>
</head>
<body class="bg-gray-100 p-3">
  <div class="container-wrapper">

    <h2 class="text-2xl font-extrabold text-center mb-4 text-gray-800">Ø³ÙÙŠØ± Ø§Ù„Ø´Ø§Ù… â€“ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„Ø¹Ø±ÙˆØ¶</h2>

    <!-- Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ -->
    <div class="section-box">
      <h4 class="text-xl font-bold mb-4">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h4>
      <form id="productForm" class="grid grid-cols-1 md-grid-cols-2 gap-4">
        <input id="pName" class="form-control" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
        <select id="pCat" class="form-control">
          <option value="Ù…ÙˆØ§Ø¯ ØºØ°Ø§Ø¦ÙŠØ©">Ù…ÙˆØ§Ø¯ ØºØ°Ø§Ø¦ÙŠØ©</option>
          <option value="Ù‡Ø¯Ø§ÙŠØ§">Ù‡Ø¯Ø§ÙŠØ§</option>
          <option value="Ø®Ø¯Ù…Ø©">Ø®Ø¯Ù…Ø©</option>
          <option value="Ø±ØµÙŠØ¯ Ù…ÙˆØ¨Ø§ÙŠÙ„">Ø±ØµÙŠØ¯ Ù…ÙˆØ¨Ø§ÙŠÙ„</option>
        </select>
        <input id="pPrice" class="form-control" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø± (â‚¬)" min="0.01" step="0.01">
                  <br>
        <button type="submit" class="btn btn-primary">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬</button>
      </form>
    </div>

    <!-- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
    <div class="section-box">
      <div class="flex justify-between items-center mb-4">
        <h4 class="text-xl font-bold">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h4>
        <button id="exportProductsBtn" class="btn btn-primary btn-sm">ØªØµØ¯ÙŠØ± Excel</button>
      </div>
      <input id="productSearch" class="form-control mb-3" type="text" placeholder="Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬...">
        <br>
      <div id="productsArea"><p class="text-gray-500 text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¹Ø¯.</p></div>
    </div>

    <!-- Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¹Ø±Ø¶ -->
    <div class="section-box">
      <h4 class="text-xl font-bold mb-4">Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¹Ø±Ø¶</h4>
      <div id="offerItems"><p class="text-gray-500 text-center">Ù„Ù… ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ Ù…Ù†ØªØ¬Ø§Øª Ù„Ù„Ø¹Ø±Ø¶.</p></div>
    </div>

    <!-- Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ø±Ø¶ -->
    <div class="section-box">
      <h4 class="text-xl font-bold mb-4">Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ø±Ø¶</h4>
      <div class="grid grid-cols-1 md-grid-cols-3 gap-4">
        <input id="customerName" type="text" class="form-control" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ">
        <input id="customerWhatsApp" type="text" class="form-control" placeholder="Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„ØªÙˆØ§ØµÙ„">
        <input id="deliveryAddress" type="text" class="form-control" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙˆØµÙŠÙ„">
      </div>

      <h4 class="mt-4 text-lg font-bold">
        Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: <span id="total" class="text-blue-600">0.00</span> â‚¬
      </h4>

      <div class="grid grid-cols-1 md-grid-cols-2 gap-4 mt-4">
        <button id="showPreviewBtn" class="btn btn-success" disabled>Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¹Ø±Ø¶</button>
        <div class="flex flex-col gap-2">
          <input id="randomOfferMax" type="number" class="form-control" value="40" min="0" step="0.01">
          <button id="generateRandomOfferBtn" class="btn btn-indigo">Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ø±Ø¶ Ø¹Ø´ÙˆØ§Ø¦ÙŠ</button>
        </div>
      </div>
    </div>

    <!-- Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© -->
    <div class="section-box">
      <h4 class="text-xl font-bold mb-4">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¹Ø±Ø¶</h4>
      <div id="preview"><p class="text-gray-500">Ù‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ø±Ø¶ Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©.</p></div>
      <button id="downloadImageBtn" class="btn btn-primary mt-4" disabled>ØªØµØ¯ÙŠØ± ÙƒØµÙˆØ±Ø©</button>
    </div>

  </div>

  <script>
    let products = [];
    let offerItems = [];
    let searchTerm = "";
    let openCategories = {};
    let randomOfferMaxValue = 40;

    const productForm = document.getElementById("productForm");
    const productsArea = document.getElementById("productsArea");
    const pName = document.getElementById("pName");
    const pCat = document.getElementById("pCat");
    const pPrice = document.getElementById("pPrice");
    const offerDiv = document.getElementById("offerItems");
    const totalSpan = document.getElementById("total");
    const previewDiv = document.getElementById("preview");
    const searchInput = document.getElementById("productSearch");
    const showPreviewBtn = document.getElementById("showPreviewBtn");
    const downloadImageBtn = document.getElementById("downloadImageBtn");
    const generateRandomOfferBtn = document.getElementById("generateRandomOfferBtn");
    const randomOfferMaxInput = document.getElementById("randomOfferMax");

    function generateId() { return Date.now().toString(36) + Math.random().toString(36).slice(2); }

    function updateTotal() {
      let total = offerItems.reduce((sum,i)=>sum+i.price,0);
      totalSpan.textContent = total.toFixed(2);
      showPreviewBtn.disabled = offerItems.length===0;
      downloadImageBtn.disabled = offerItems.length===0;
    }

    function renderProducts() {
      productsArea.innerHTML="";
      let grouped={};
      products.forEach(p=>{
        if(searchTerm && !p.name.includes(searchTerm)) return;
        if(!grouped[p.category]) grouped[p.category]=[];
        grouped[p.category].push(p);
      });
      Object.keys(grouped).forEach(cat=>{
        const catBox=document.createElement("div");
        const catHeader=document.createElement("div");
        catHeader.className="category-header";
        catHeader.innerHTML=`<span>${cat}</span><span>â–¼</span>`;
        catHeader.onclick=()=>{ openCategories[cat]=!openCategories[cat]; renderProducts(); };
        catBox.appendChild(catHeader);
        if(openCategories[cat]){
          grouped[cat].forEach(p=>{
            const item=document.createElement("div");
            item.className="product-row";
            item.innerHTML=`<span class="product-name">${p.name}</span><span class="product-price">${p.price.toFixed(2)} â‚¬</span><button class="add-btn-circle" onclick="addToOffer('${p.id}')">+</button>`;
            catBox.appendChild(item);
          });
        }
        productsArea.appendChild(catBox);
      });
      if(!products.length) productsArea.innerHTML=`<p class="text-gray-500 text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¹Ø¯.</p>`;
    }

    function addToOffer(id){ const product=products.find(p=>p.id===id); offerItems.push({...product}); renderOfferItems(); updateTotal(); }
    function removeFromOffer(index){ offerItems.splice(index,1); renderOfferItems(); updateTotal(); }
    function renderOfferItems(){
      if(!offerItems.length){ offerDiv.innerHTML=`<p class="text-gray-500 text-center">Ù„Ù… ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ Ù…Ù†ØªØ¬Ø§Øª Ù„Ù„Ø¹Ø±Ø¶.</p>`; return; }
      offerDiv.innerHTML="";
      offerItems.forEach((item,index)=>{
        const div=document.createElement("div"); div.className="offer-item";
        div.innerHTML=`<p>${item.name}</p><p>${item.price.toFixed(2)} â‚¬</p><button class="btn btn-danger btn-sm" onclick="removeFromOffer(${index})">Ã—</button>`;
        offerDiv.appendChild(div);
      });
    }

    productForm.addEventListener("submit",e=>{
      e.preventDefault();
      if(!pName.value || !pPrice.value) return;
      products.push({id:generateId(), name:pName.value, category:pCat.value, price:parseFloat(pPrice.value)});
      pName.value=""; pPrice.value=""; renderProducts();
    });
    searchInput.addEventListener("input",()=>{ searchTerm=searchInput.value; renderProducts(); });

    showPreviewBtn.addEventListener("click",()=>{
      previewDiv.innerHTML=`
        <h3 class="font-bold text-xl mb-2">ğŸ’™ Ø³ÙÙŠØ± Ø§Ù„Ø´Ø§Ù… â€“ Ø¹Ø±Ø¶ Ø®Ø§Øµ</h3>
        <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${document.getElementById("customerName").value}</p>
        <p><strong>ÙˆØ§ØªØ³Ø§Ø¨:</strong> ${document.getElementById("customerWhatsApp").value}</p>
        <p><strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> ${document.getElementById("deliveryAddress").value}</p>
        <hr class="my-3">
        <div class="text-right w-full">
          ${offerItems.map(i=>`<div class='flex justify-between border-b py-1'><span>${i.name}</span><span>${i.price.toFixed(2)} â‚¬</span></div>`).join("")}
        </div>
        <h3 class="mt-4 text-lg font-bold">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: ${totalSpan.textContent} â‚¬</h3>
        <p class="text-sm text-gray-500 mt-2">ØªÙ†ÙˆÙŠÙ‡: Ù‚Ø¯ ØªÙƒÙˆÙ† Ù‡Ù†Ø§Ùƒ ØªÙƒÙ„ÙØ© ØªÙˆØµÙŠÙ„ ÙˆØ¹Ù…ÙˆÙ„Ø© ØªØ­ÙˆÙŠÙ„ ØªÙØ­Ø¯Ø¯ Ù„Ø§Ø­Ù‚Ø§Ù‹.</p>
      `;
    });

    randomOfferMaxInput.addEventListener("input",()=>{ randomOfferMaxValue=parseFloat(randomOfferMaxInput.value); });

    generateRandomOfferBtn.addEventListener("click",()=>{
      offerItems=[];
      const foodProducts=products.filter(p=>p.category==="Ù…ÙˆØ§Ø¯ ØºØ°Ø§Ø¦ÙŠØ©" && p.price<=randomOfferMaxValue);
      let total=0;
      const shuffled=[...foodProducts].sort(()=>Math.random()-0.5);
      for(let p of shuffled){ if(total+p.price<=randomOfferMaxValue){ offerItems.push(p); total+=p.price; } }
      renderOfferItems(); updateTotal(); showPreviewBtn.click();
    });

  </script>
</body>
</html>